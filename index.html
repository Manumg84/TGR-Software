<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Taller</title>
    <!-- Google Fonts - Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="d-flex" id="wrapper">
        <!-- Sidebar -->
        <nav id="sidebar">
            <div class="sidebar-header">
                <i class="fas fa-tools icon"></i>
                <span class="logo-name">TallerApp</span>
            </div>

            <ul class="nav-links list-unstyled">
                <li>
                    <a href="#" class="nav-link active" data-target="dashboard" data-name="Dashboard" data-icon="fas fa-tachometer-alt">
                        <i class="fas fa-tachometer-alt icon me-2"></i>
                        <span class="link-name">Dashboard</span>
                    </a>
                </li>
                 <li>
                    <a href="#" class="nav-link" data-target="gestion" data-name="Gestión" data-icon="fas fa-tasks">
                        <i class="fas fa-tasks icon me-2"></i>
                        <span class="link-name">Gestión</span>
                    </a>
                </li>
                 <li>
                    <a href="#" class="nav-link" data-target="ordenes_parent" data-name="Órdenes de trabajos" data-icon="fas fa-clipboard-list">
                        <i class="fas fa-clipboard-list icon me-2"></i>
                        <span class="link-name">Ordenes de trabajos</span>
                    </a>
                </li>
                 <li>
                    <a href="#" class="nav-link" data-target="settings" data-name="Configuración" data-icon="fas fa-cog">
                        <i class="fas fa-cog icon me-2"></i>
                        <span class="link-name">Configuración</span>
                    </a>
                </li>
            </ul>

            <!-- Calendar Widget Column moved to sidebar -->
            <div class="p-3">
                <div class="dashboard-card calendar-widget sidebar-card" style="cursor: pointer;">
                    <div class="card-body text-center p-0">
                        <h5 class="card-title text-dark-emphasis mb-2">Fecha Actual</h5>
                        <h3 class="display-6 text-primary fw-bold" id="currentDay"></h3>
                        <p class="lead text-dark-emphasis mb-1" id="currentMonth"></p>
                        <p class="lead text-dark-emphasis mb-2" id="currentYear"></p>
                        <small class="text-muted">Haz clic para ver agenda</small>
                    </div>
                </div>
            </div>

            <!-- Agenda Events Display Column moved to sidebar -->
            <div class="p-3 pt-0">
                <div class="dashboard-card agenda-display sidebar-card">
                    <div class="card-header bg-white border-0 pb-0 pt-3">
                        <h5 class="mb-0 text-dark-emphasis">Próximos Eventos</h5>
                    </div>
                    <ul class="list-group list-group-flush" id="agendaEventsList">
                        <!-- Events will be dynamically loaded here by JavaScript -->
                        <li class="list-group-item text-muted">No hay eventos próximos.</li>
                    </ul>
                </div>
            </div>

            <!-- User Profile moved to sidebar footer -->
            <div id="sidebar-footer" class="mt-auto p-3 border-top">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <div class="position-relative">
                        <i class="fas fa-bell fs-5 text-muted"></i>
                        <span class="badge bg-danger rounded-circle position-absolute top-0 start-100 translate-middle p-1">
                            <span class="visually-hidden">New alerts</span>
                        </span>
                    </div>
                </div>
                <div class="user-profile d-flex align-items-center">
                    <img src="https://via.placeholder.com/40" alt="User Avatar" class="rounded-circle me-2">
                    <span class="fw-bold text-dark">John Doe</span>
                    <i class="fas fa-chevron-down ms-2 text-muted"></i>
                </div>
            </div>
        </nav>
        <!-- /#sidebar -->

        <!-- Page Content Wrapper -->
        <div id="page-content-wrapper" class="d-flex flex-column flex-grow-1">
            <!-- Top Navbar -->
            <header id="top-navbar" class="p-3 bg-white border-bottom shadow-sm d-flex align-items-center justify-content-start">
                <div class="d-flex w-100 justify-content-around align-items-center">
                    <!-- Total Earnings Card -->
                    <div class="dashboard-card primary-card text-white top-navbar-card mx-2">
                        <div class="card-body d-flex align-items-center justify-content-between">
                            <div class="d-flex flex-column text-nowrap overflow-hidden">
                                <h5 class="card-title text-white-50 mb-0">Total Ganancias</h5>
                                <p class="card-text text-white-50 mb-0"><small>Último Mes</small></p>
                            </div>
                            <div class="d-flex align-items-center flex-shrink-0">
                                <h2 class="mb-0 fw-bold me-2">€12,345</h2>
                                <i class="fas fa-dollar-sign fa-lg text-white-50"></i>
                            </div>
                        </div>
                    </div>
                    <!-- New Clients Card -->
                    <div class="dashboard-card success-card text-white top-navbar-card mx-2">
                        <div class="card-body d-flex align-items-center justify-content-between">
                            <div class="d-flex flex-column text-nowrap overflow-hidden">
                                <h5 class="card-title text-white-50 mb-0">Nuevos Clientes</h5>
                                <p class="card-text text-white-50 mb-0"><small>Este Mes</small></p>
                            </div>
                            <div class="d-flex align-items-center flex-shrink-0">
                                <h2 class="mb-0 fw-bold me-2">75</h2>
                                <i class="fas fa-user-plus fa-lg text-white-50"></i>
                            </div>
                        </div>
                    </div>
                    <!-- Pending Repairs Card -->
                    <div class="dashboard-card warning-card text-white top-navbar-card mx-2">
                        <div class="card-body d-flex align-items-center justify-content-between">
                            <div class="d-flex flex-column text-nowrap overflow-hidden">
                                <h5 class="card-title text-white-50 mb-0">Reparaciones Pendientes</h5>
                                <p class="card-text text-white-50 mb-0"><small>Activas</small></p>
                            </div>
                            <div class="d-flex align-items-center flex-shrink-0">
                                <h2 class="mb-0 fw-bold me-2">18</h2>
                                <i class="fas fa-wrench fa-lg text-white-50"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            <!-- /#top-navbar -->

            <!-- Main Content -->
            <main id="main-content" class="flex-grow-1 p-4">
                <div class="d-flex justify-content-between align-items-end mb-3">
                    <!-- Tab navigation -->
                    <ul class="nav nav-tabs" id="mainContentTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" data-bs-target="#dashboard-pane" type="button" role="tab" aria-controls="dashboard-pane" aria-selected="true">
                                <span class="tab-label"><i class="fas fa-tachometer-alt me-2"></i> Dashboard</span>
                            </button>
                        </li>
                        <!-- Other tabs will be dynamically added here by JS -->
                    </ul>
                    <!-- New Messaging Button -->
                    <button class="btn btn-primary btn-sm ms-auto" id="openChatBtn">
                        <i class="fas fa-comments me-2"></i> Mensajes
                    </button>
                </div>

                <!-- Tab content -->
                <div class="tab-content" id="mainContentTabContent">
                    <div class="tab-pane fade show active" id="dashboard-pane" role="tabpanel" aria-labelledby="dashboard-tab">
                        <!-- Recent Activity Table -->
                        <div class="row">
                            <div class="col-12">
                                <div class="dashboard-card">
                                    <div class="card-header bg-white border-0 pb-0 pt-3">
                                        <h5 class="mb-0 text-dark-emphasis">Actividad Reciente</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-hover mb-0">
                                                <thead>
                                                    <tr>
                                                        <th scope="col">#</th>
                                                        <th scope="col">Cliente</th>
                                                        <th scope="col">Servicio</th>
                                                        <th scope="col">Estado</th>
                                                        <th scope="col">Fecha</th>
                                                        <th scope="col">Total</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="recentActivityTableBody">
                                                    <!-- Activities will be dynamically loaded here by JavaScript -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Dummy Content Sections are now dynamically loaded into tabs -->
                </div>
            </main>
            <!-- /#main-content -->
        </div>
        <!-- /#page-content-wrapper -->
    </div>
    <!-- /#wrapper -->

    <!-- Gestion Modal -->
    <div class="modal fade" id="gestionModal" data-bs-backdrop="static" tabindex="-1" aria-labelledby="gestionModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content border-0 shadow-lg dashboard-card">
                <div class="modal-header bg-white border-0 pb-0">
                    <h5 class="modal-title text-dark-emphasis" id="gestionModalLabel"><i class="fas fa-tasks me-2 text-primary"></i> Gestión</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex align-items-center bg-transparent border-0 py-2 ps-0">
                            <a href="#" class="nav-link-in-modal text-dark text-decoration-none w-100" data-bs-dismiss="modal" data-target="clientes" data-name="Clientes" data-icon="fas fa-users">
                                <i class="fas fa-users me-2"></i> Clientes
                            </a>
                        </li>
                        <li class="list-group-item d-flex align-items-center bg-transparent border-0 py-2 ps-0">
                            <a href="#" class="nav-link-in-modal text-dark text-decoration-none w-100" data-bs-dismiss="modal" data-target="proveedores" data-name="Proveedores" data-icon="fas fa-truck">
                                <i class="fas fa-truck me-2"></i> Proveedores
                            </a>
                        </li>
                        <li class="list-group-item d-flex align-items-center bg-transparent border-0 py-2 ps-0">
                            <a href="#" class="nav-link-in-modal text-dark text-decoration-none w-100" data-bs-dismiss="modal" data-target="categorias" data-name="Categorías" data-icon="fas fa-tags">
                                <i class="fas fa-tags me-2"></i> Categorías
                            </a>
                        </li>
                        <li class="list-group-item d-flex align-items-center bg-transparent border-0 py-2 ps-0">
                            <a href="#" class="nav-link-in-modal text-dark text-decoration-none w-100" data-bs-dismiss="modal" data-target="operarios" data-name="Operarios" data-icon="fas fa-user-cog">
                                <i class="fas fa-user-cog me-2"></i> Operarios
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Agenda Modal -->
    <div class="modal fade" id="agendaModal" tabindex="-1" aria-labelledby="agendaModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg dashboard-card">
                <div class="modal-header bg-white border-0 pb-0">
                    <h5 class="modal-title text-dark-emphasis" id="agendaModalLabel"><i class="fas fa-calendar-check me-2 text-primary"></i> Mi Agenda</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body pt-0">
                    <form id="eventForm" class="mb-4 p-3 border rounded bg-light-subtle">
                        <h6 class="mb-3 text-dark-emphasis">Añadir Nuevo Evento/Nota</h6>
                        <div class="mb-3">
                            <label for="eventDate" class="form-label text-muted">Fecha</label>
                            <input type="date" class="form-control" id="eventDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="eventTime" class="form-label text-muted">Hora (opcional)</label>
                            <input type="time" class="form-control" id="eventTime">
                        </div>
                        <div class="mb-3">
                            <label for="eventDescription" class="form-label text-muted">Descripción</label>
                            <textarea class="form-control" id="eventDescription" rows="3" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary w-100"><i class="fas fa-plus me-2"></i> Añadir Evento</button>
                    </form>
                    <hr>
                    <h6 class="text-dark-emphasis">Eventos Programados</h6>
                    <div id="eventsContainer">
                        <ul class="list-group" id="modalEventsList">
                            <!-- Dynamic events loaded here by JavaScript -->
                            <li class="list-group-item text-muted">No hay eventos programados.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /Agenda Modal -->

    <!-- User Management Modal -->
    <div class="modal fade" id="userModal" tabindex="-1" aria-labelledby="userModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-md modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg dashboard-card">
                <div class="modal-header bg-white border-0 pb-0">
                    <h5 class="modal-title text-dark-emphasis" id="userModalLabel"><i class="fas fa-user-plus me-2 text-primary"></i> Gestión de Usuario</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body pt-0">
                    <form id="userForm" class="p-3 border rounded bg-light-subtle">
                        <input type="hidden" id="userId">
                        <input type="hidden" id="userMode"> <!-- To store 'create', 'view', 'edit' -->
                        <div class="mb-3">
                            <label for="userName" class="form-label text-muted">Nombre</label>
                            <input type="text" class="form-control" id="userName" required>
                        </div>
                        <div class="mb-3">
                            <label for="userLevel" class="form-label text-muted">Nivel de Usuario
                                <button type="button" class="btn btn-sm btn-warning ms-2 p-0" id="openUserLevelsManagerBtn" title="Acceso a niveles" style="width: 24px; height: 24px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-list fa-xs"></i>
                                </button>
                            </label>
                            <select class="form-select" id="userLevel" required>
                                <option value="">Selecciona un nivel</option>
                                <!-- Options will be dynamically loaded here by JavaScript -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="userPassword" class="form-label text-muted">Contraseña</label>
                            <input type="password" class="form-control" id="userPassword" placeholder="********" autocomplete="new-password">
                        </div>
                        <button type="submit" class="btn btn-primary w-100" id="userModalSubmitBtn"><i class="fas fa-save me-2"></i> Guardar Usuario</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- /User Management Modal -->

    <!-- User Level Manager Modal -->
    <div class="modal fade" id="userLevelManagerModal" tabindex="-1" aria-labelledby="userLevelManagerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-md modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg dashboard-card">
                <div class="modal-header bg-white border-0 pb-0">
                    <h5 class="modal-title text-dark-emphasis" id="userLevelManagerModalLabel"><i class="fas fa-sitemap me-2 text-primary"></i> Gestión de Niveles de Usuario</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body pt-0">
                    <form id="userLevelForm" class="p-3 border rounded bg-light-subtle mb-4" style="display:none;">
                        <input type="hidden" id="userLevelId">
                        <input type="hidden" id="userLevelMode"> <!-- To store 'create', 'view', 'edit' for this specific level's form -->
                        <h6 class="mb-3 text-dark-emphasis" id="userLevelFormTitle">Añadir Nuevo Nivel</h6>
                        <div class="mb-3">
                            <label for="userLevelName" class="form-label text-muted">Nombre del Nivel</label>
                            <input type="text" class="form-control" id="userLevelName" required>
                        </div>
                        <div class="mb-3">
                            <label for="userLevelRules" class="form-label text-muted">Reglas/Descripción</label>
                            <textarea class="form-control" id="userLevelRules" rows="3" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary w-100" id="userLevelFormSubmitBtn"><i class="fas fa-plus me-2"></i> Añadir Nivel</button>
                        <button type="button" class="btn btn-secondary w-100 mt-2" id="cancelUserLevelFormBtn"><i class="fas fa-times me-2"></i> Cancelar</button>
                    </form>

                    <hr>
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="mb-0 text-dark-emphasis">Niveles Existentes</h5>
                        <button class="btn btn-primary btn-sm" id="addNewUserLevelBtn"><i class="fas fa-plus me-2"></i> Nuevo Nivel</button>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-hover mb-0" id="userLevelsTable">
                            <thead>
                                <tr>
                                    <th scope="col">ID</th>
                                    <th scope="col">Nombre</th>
                                    <th scope="col">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="userLevelsTableBody">
                                <!-- User levels will be dynamically loaded here by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /User Level Manager Modal -->

    <!-- Work Status Management Modal -->
    <div class="modal fade" id="workStatusModal" tabindex="-1" aria-labelledby="workStatusModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-md modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg dashboard-card">
                <div class="modal-header bg-white border-0 pb-0">
                    <h5 class="modal-title text-dark-emphasis" id="workStatusModalLabel"><i class="fas fa-clipboard-check me-2 text-primary"></i> Gestión de Estados de Trabajo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body pt-0">
                    <form id="workStatusForm" class="p-3 border rounded bg-light-subtle">
                        <input type="hidden" id="workStatusId">
                        <input type="hidden" id="workStatusMode"> <!-- To store 'create', 'view', 'edit' -->
                        <div class="mb-3">
                            <label for="workStatusName" class="form-label text-muted">Nombre del Estado</label>
                            <input type="text" class="form-control" id="workStatusName" required>
                        </div>
                        <div class="mb-3">
                            <label for="workStatusDescription" class="form-label text-muted">Descripción (opcional)</label>
                            <textarea class="form-control" id="workStatusDescription" rows="3"></textarea>
                        </div>
                        <div class="d-flex justify-content-end">
                            <button type="button" class="btn btn-danger me-auto" id="workStatusModalDeleteBtn" style="display: none;"><i class="fas fa-trash me-2"></i> Borrar Estado</button>
                            <button type="submit" class="btn btn-primary" id="workStatusModalSubmitBtn"><i class="fas fa-plus me-2"></i> Añadir Estado</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- /Work Status Management Modal -->

    <!-- Client Management Modal -->
    <div class="modal fade" id="clientModal" tabindex="-1" aria-labelledby="clientModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg dashboard-card">
                <div class="modal-header bg-white border-0 pb-0">
                    <h5 class="modal-title text-dark-emphasis" id="clientModalLabel"><i class="fas fa-user me-2 text-primary"></i> Gestión de Cliente</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body pt-0">
                    <form id="clientForm" class="p-3 border rounded">
                        <input type="hidden" id="clientId">
                        <input type="hidden" id="clientMode"> <!-- To store 'create', 'view', 'edit' -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="clientNameOrCompany" class="form-label text-muted">Nombre o Empresa</label>
                                <input type="text" class="form-control" id="clientNameOrCompany" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="clientCifNif" class="form-label text-muted">CIF/NIF</label>
                                <input type="text" class="form-control" id="clientCifNif" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="clientAddress" class="form-label text-muted">Dirección</label>
                                <input type="text" class="form-control" id="clientAddress" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="clientCity" class="form-label text-muted">Localidad</label>
                                <input type="text" class="form-control" id="clientCity" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="clientProvince" class="form-label text-muted">Provincia</label>
                                <input type="text" class="form-control" id="clientProvince" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="clientPostalCode" class="form-label text-muted">Código Postal</label>
                                <input type="text" class="form-control" id="clientPostalCode" pattern="[0-9]{5}" title="Debe ser un código postal de 5 dígitos numéricos" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="clientPhone1" class="form-label text-muted">Teléfono 1</label>
                                <input type="text" class="form-control" id="clientPhone1" pattern="[0-9]{9}" title="Debe ser un número de teléfono de 9 dígitos numéricos" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="clientPhone2" class="form-label text-muted">Teléfono 2 (Opcional)</label>
                                <input type="text" class="form-control" id="clientPhone2" pattern="[0-9]{9}" title="Debe ser un número de teléfono de 9 dígitos numéricos">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="clientEmail" class="form-label text-muted">Email</label>
                                <input type="email" class="form-control" id="clientEmail" required>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label for="clientObservations" class="form-label text-muted">Observaciones</label>
                            <textarea class="form-control" id="clientObservations" rows="3"></textarea>
                        </div>
                        <div class="d-flex justify-content-end">
                            <button type="button" class="btn btn-danger me-auto" id="clientModalDeleteBtn" style="display: none;"><i class="fas fa-trash me-2"></i> Borrar Cliente</button>
                            <button type="button" class="btn btn-warning me-2" id="clientModalEditBtn" style="display: none;"><i class="fas fa-edit me-2"></i> Editar Cliente</button>
                            <button class="btn btn-primary" id="clientModalSubmitBtn"><i class="fas fa-plus me-2"></i> Crear Cliente</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- /Client Management Modal -->

    <!-- Supplier Management Modal -->
    <div class="modal fade" id="proveedorModal" tabindex="-1" aria-labelledby="proveedorModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg dashboard-card">
                <div class="modal-header bg-white border-0 pb-0">
                    <h5 class="modal-title text-dark-emphasis" id="proveedorModalLabel"><i class="fas fa-truck me-2 text-primary"></i> Gestión de Proveedor</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body pt-0">
                    <form id="proveedorForm" class="p-3 border rounded bg-light-subtle">
                        <input type="hidden" id="proveedorId">
                        <input type="hidden" id="proveedorMode"> <!-- To store 'create', 'view', 'edit' -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="proveedorNameOrCompany" class="form-label text-muted">Nombre o Empresa</label>
                                <input type="text" class="form-control" id="proveedorNameOrCompany" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="proveedorCifNif" class="form-label text-muted">CIF/NIF</label>
                                <input type="text" class="form-control" id="proveedorCifNif" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="proveedorAddress" class="form-label text-muted">Dirección</label>
                                <input type="text" class="form-control" id="proveedorAddress" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="proveedorCity" class="form-label text-muted">Localidad</label>
                                <input type="text" class="form-control" id="proveedorCity" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="proveedorProvince" class="form-label text-muted">Provincia</label>
                                <input type="text" class="form-control" id="proveedorProvince" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="proveedorPostalCode" class="form-label text-muted">Código Postal</label>
                                <input type="text" class="form-control" id="proveedorPostalCode" pattern="[0-9]{5}" title="Debe ser un código postal de 5 dígitos numéricos" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="proveedorPhone1" class="form-label text-muted">Teléfono 1</label>
                                <input type="text" class="form-control" id="proveedorPhone1" pattern="[0-9]{9}" title="Debe ser un número de teléfono de 9 dígitos numéricos" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="proveedorPhone2" class="form-label text-muted">Teléfono 2 (Opcional)</label>
                                <input type="text" class="form-control" id="proveedorPhone2" pattern="[0-9]{9}" title="Debe ser un número de teléfono de 9 dígitos numéricos">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="proveedorEmail" class="form-label text-muted">Email</label>
                                <input type="email" class="form-control" id="proveedorEmail" required>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label for="proveedorObservations" class="form-label text-muted">Observaciones</label>
                            <textarea class="form-control" id="proveedorObservations" rows="3"></textarea>
                        </div>
                        <div class="d-flex justify-content-end">
                            <button type="button" class="btn btn-danger me-auto" id="proveedorModalDeleteBtn" style="display: none;"><i class="fas fa-trash me-2"></i> Borrar Proveedor</button>
                            <button class="btn btn-primary" id="proveedorModalSubmitBtn"><i class="fas fa-plus me-2"></i> Crear Proveedor</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- /Supplier Management Modal -->

    <!-- Operator Management Modal -->
    <div class="modal fade" id="operarioModal" tabindex="-1" aria-labelledby="operarioModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg dashboard-card">
                <div class="modal-header bg-white border-0 pb-0">
                    <h5 class="modal-title text-dark-emphasis" id="operarioModalLabel"><i class="fas fa-user-cog me-2 text-primary"></i> Gestión de Operario</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body pt-0">
                    <form id="operarioForm" class="p-3 border rounded bg-light-subtle">
                        <input type="hidden" id="operarioId">
                        <input type="hidden" id="operarioMode"> <!-- To store 'create', 'view', 'edit' -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="operarioFullName" class="form-label text-muted">Nombre Completo</label>
                                <input type="text" class="form-control" id="operarioFullName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="operarioDniNie" class="form-label text-muted">DNI/NIE</label>
                                <input type="text" class="form-control" id="operarioDniNie" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="operarioPosition" class="form-label text-muted">Cargo</label>
                                <input type="text" class="form-control" id="operarioPosition" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="operarioHireDate" class="form-label text-muted">Fecha Contratación</label>
                                <input type="date" class="form-control" id="operarioHireDate" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="operarioPhone" class="form-label text-muted">Teléfono</label>
                                <input type="text" class="form-control" id="operarioPhone" pattern="[0-9]{9}" title="Debe ser un número de teléfono de 9 dígitos numéricos" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="operarioEmail" class="form-label text-muted">Email</label>
                                <input type="email" class="form-control" id="operarioEmail" required>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label for="operarioObservations" class="form-label text-muted">Observaciones</label>
                            <textarea class="form-control" id="operarioObservations" rows="3"></textarea>
                        </div>
                        <div class="d-flex justify-content-end">
                            <button type="button" class="btn btn-danger me-auto" id="operarioModalDeleteBtn" style="display: none;"><i class="fas fa-trash me-2"></i> Borrar Operario</button>
                            <button class="btn btn-primary" id="operarioModalSubmitBtn"><i class="fas fa-plus me-2"></i> Crear Operario</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- /Operator Management Modal -->

    <!-- Category Management Modal -->
    <div class="modal fade" id="categoryModal" tabindex="-1" aria-labelledby="categoryModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg dashboard-card">
                <div class="modal-header bg-white border-0 pb-0">
                    <h5 class="modal-title text-dark-emphasis" id="categoryModalLabel"><i class="fas fa-tags me-2 text-primary"></i> Gestión de Categoría</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body pt-0">
                    <form id="categoryForm" class="p-3 border rounded bg-light-subtle">
                        <input type="hidden" id="categoryId">
                        <input type="hidden" id="categoryMode">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="categoryName" class="form-label text-muted">Nombre de la Categoría</label>
                                <input type="text" class="form-control" id="categoryName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="categoryCode" class="form-label text-muted">Código</label>
                                <input type="text" class="form-control" id="categoryCode" required>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label for="categoryObservations" class="form-label text-muted">Observaciones</label>
                            <textarea class="form-control" id="categoryObservations" rows="3"></textarea>
                        </div>
                        <div class="d-flex justify-content-end">
                            <button type="button" class="btn btn-danger me-auto" id="categoryModalDeleteBtn" style="display: none;"><i class="fas fa-trash me-2"></i> Borrar Categoría</button>
                            <button type="button" class="btn btn-info" id="tiposCatBtn" style="display: none;"><i class="fas fa-sitemap me-2"></i> Tipos de CAT</button>
                            <button class="btn btn-primary ms-2" id="categoryModalSubmitBtn"><i class="fas fa-plus me-2"></i> Crear Categoría</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- /Category Management Modal -->

    <!-- Tipos de Categoria Modal -->
    <div class="modal fade" id="tiposCatModal" tabindex="-1" aria-labelledby="tiposCatModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg dashboard-card">
                <div class="modal-header bg-white border-0 pb-0">
                    <h5 class="modal-title text-dark-emphasis" id="tiposCatModalLabel"><i class="fas fa-sitemap me-2 text-primary"></i> Tipos de Subcategoría</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body pt-0">
                    <form id="tiposCatForm" class="p-3">
                        <input type="hidden" id="tiposCatParentId">
                        <div class="mb-3">
                            <label for="tipoCat1" class="form-label text-muted">Tipo 1</label>
                            <div class="input-group">
                                <input type="number" step="0.01" min="0" class="form-control" id="tipoCat1" required>
                                <span class="input-group-text">€/hr</span>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="tipoCat2" class="form-label text-muted">Tipo 2</label>
                            <div class="input-group">
                                <input type="number" step="0.01" min="0" class="form-control" id="tipoCat2" required>
                                <span class="input-group-text">€/hr</span>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="tipoCat3" class="form-label text-muted">Tipo 3</label>
                            <div class="input-group">
                                <input type="number" step="0.01" min="0" class="form-control" id="tipoCat3" required>
                                <span class="input-group-text">€/hr</span>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="tipoCat4" class="form-label text-muted">Tipo 4</label>
                            <div class="input-group">
                                <input type="number" step="0.01" min="0" class="form-control" id="tipoCat4" required>
                                <span class="input-group-text">€/hr</span>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="tipoCat5" class="form-label text-muted">Tipo 5</label>
                            <div class="input-group">
                                <input type="number" step="0.01" min="0" class="form-control" id="tipoCat5" required>
                                <span class="input-group-text">€/hr</span>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100"><i class="fas fa-save me-2"></i> Guardar y Cerrar</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- /Tipos de Categoria Modal -->

    <!-- Subcategory Management Modal -->
    <div class="modal fade" id="subcategoryModal" tabindex="-1" aria-labelledby="subcategoryModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg dashboard-card">
                <div class="modal-header bg-white border-0 pb-0">
                    <h5 class="modal-title text-dark-emphasis" id="subcategoryModalLabel">
                        <i class="fas fa-sitemap me-2 text-primary"></i> Gestión de Subcategorías
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body pt-0">
                    <!-- Form to Add/Edit Subcategory -->
                    <form id="subcategoryForm" class="p-3 border rounded bg-light-subtle mb-4">
                        <input type="hidden" id="subcategoryId">
                        <input type="hidden" id="parentCategoryId">
                        <input type="hidden" id="subcategoryMode" value="create">
                        <h6 class="mb-3 text-dark-emphasis" id="subcategoryFormTitle">Añadir Nueva Subcategoría</h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="subcategoryName" class="form-label text-muted">Nombre</label>
                                <input type="text" class="form-control" id="subcategoryName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="subcategoryCode" class="form-label text-muted">Código</label>
                                <input type="text" class="form-control" id="subcategoryCode" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="subcategoryImporte" class="form-label text-muted">Importe</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="subcategoryImporte" step="0.01" min="0" required>
                                    <span class="input-group-text">€/hr</span>
                                </div>
                            </div>
                        </div>
                        <div class="d-flex justify-content-end">
                            <button type="button" class="btn btn-secondary me-2" id="cancelSubcategoryFormBtn" style="display: none;">Cancelar</button>
                            <button type="submit" class="btn btn-primary" id="subcategoryFormSubmitBtn"><i class="fas fa-plus me-2"></i> Añadir</button>
                        </div>
                    </form>
                    
                    <hr>
                    
                    <!-- Table of existing subcategories -->
                    <h5 class="mb-3 text-dark-emphasis">Subcategorías Existentes</h5>
                    <div class="table-responsive">
                        <table class="table table-hover mb-0" id="subcategoriesTable">
                            <thead>
                                <tr>
                                    <th scope="col">Nombre</th>
                                    <th scope="col">Código</th>
                                    <th scope="col">Importe</th>
                                    <th scope="col">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="subcategoriesTableBody">
                                <!-- Subcategories will be dynamically loaded here by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /Subcategory Management Modal -->

    <!-- Presupuesto Management Modal -->
    <div class="modal fade" id="presupuestoModal" tabindex="-1" aria-labelledby="presupuestoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg dashboard-card">
                <div class="modal-header bg-white border-0 pb-0">
                    <h5 class="modal-title text-dark-emphasis" id="presupuestoModalLabel"><i class="fas fa-file-invoice-dollar me-2 text-primary"></i> Gestión de Presupuesto</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body pt-0">
                    <form id="presupuestoForm" class="p-3 border rounded">
                        <input type="hidden" id="presupuestoId">
                        <input type="hidden" id="presupuestoMode"> <!-- To store 'create', 'view', 'edit' -->
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="presupuestoNumero" class="form-label text-muted">N° Presupuesto</label>
                                <input type="text" class="form-control" id="presupuestoNumero" readonly>
                            </div>
                            <div class="col-md-8 mb-3">
                                <label for="presupuestoClienteId" class="form-label text-muted">Cliente</label>
                                <div class="autocomplete-container">
                                    <input type="text" class="form-control" id="presupuestoClienteSearch" placeholder="Buscar cliente..." required>
                                    <input type="hidden" id="presupuestoClienteId" name="presupuestoClienteId">
                                    <div class="autocomplete-suggestions" id="presupuestoClienteSuggestions"></div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label for="presupuestoConcepto" class="form-label text-muted">Concepto</label>
                                <input type="text" class="form-control" id="presupuestoConcepto" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="presupuestoNumSolicitud" class="form-label text-muted">N° Solicitud</label>
                                <input type="text" class="form-control" id="presupuestoNumSolicitud">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="presupuestoTexto" class="form-label text-muted">Texto del Presupuesto</label>
                            <textarea class="form-control" id="presupuestoTexto" rows="4"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3 ms-auto">
                                <label for="presupuestoImporte" class="form-label text-muted">Importe Total</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="presupuestoImporte" step="0.01" min="0" required>
                                    <span class="input-group-text">€</span>
                                </div>
                            </div>
                        </div>
                        <div class="d-flex justify-content-end">
                            <button type="button" class="btn btn-danger me-auto" id="presupuestoModalDeleteBtn" style="display: none;"><i class="fas fa-trash me-2"></i> Borrar Presupuesto</button>
                            <button class="btn btn-primary" id="presupuestoModalSubmitBtn"><i class="fas fa-plus me-2"></i> Crear Presupuesto</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- /Presupuesto Management Modal -->

    <!-- Orden de Trabajo Management Modal -->
    <div class="modal fade" id="ordenTrabajoModal" tabindex="-1" aria-labelledby="ordenTrabajoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg dashboard-card">
                <div class="modal-header bg-white border-0 pb-0">
                    <h5 class="modal-title text-dark-emphasis" id="ordenTrabajoModalLabel"><i class="fas fa-file-alt me-2 text-primary"></i> Gestión de Orden de Trabajo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body pt-0">
                    <form id="ordenTrabajoForm" class="p-3 border rounded">
                        <input type="hidden" id="ordenTrabajoId">
                        <input type="hidden" id="ordenTrabajoMode"> <!-- To store 'create', 'view', 'edit' -->
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="ordenTrabajoNumero" class="form-label text-muted">N° Orden</label>
                                <input type="text" class="form-control" id="ordenTrabajoNumero" readonly>
                            </div>
                            <div class="col-md-8 mb-3">
                                <label for="ordenTrabajoClienteId" class="form-label text-muted">Cliente</label>
                                <div class="autocomplete-container">
                                    <input type="text" class="form-control" id="ordenTrabajoClienteSearch" placeholder="Buscar cliente..." required>
                                    <input type="hidden" id="ordenTrabajoClienteId" name="ordenTrabajoClienteId">
                                    <div class="autocomplete-suggestions" id="ordenTrabajoClienteSuggestions"></div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label for="ordenTrabajoConcepto" class="form-label text-muted">Concepto</label>
                                <input type="text" class="form-control" id="ordenTrabajoConcepto" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="ordenTrabajoEstado" class="form-label text-muted">Estado</label>
                                <select class="form-select" id="ordenTrabajoEstado" required>
                                    <!-- Options will be dynamically loaded here by JavaScript -->
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="ordenTrabajoObservaciones" class="form-label text-muted">Observaciones</label>
                            <textarea class="form-control" id="ordenTrabajoObservaciones" rows="4"></textarea>
                        </div>

                        <!-- Horas de Trabajo Table -->
                        <hr class="my-4">
                        <h6 class="mb-3 text-dark-emphasis">Líneas de Horas de Trabajo</h6>
                        <div class="table-responsive mb-3">
                            <table class="table table-bordered table-sm" id="workHoursTable">
                                <thead class="table-light">
                                    <tr>
                                        <th style="width: 15%;">Operario</th>
                                        <th style="width: 15%;">Categoría</th>
                                        <th style="width: 15%;">Tipo</th>
                                        <th style="width: 10%;">Fecha</th>
                                        <th style="width: 20%;">Concepto</th>
                                        <th style="width: 7%;">Horas</th>
                                        <th style="width: 10%;">Importe</th>
                                        <th style="width: 5%;"></th>
                                    </tr>
                                </thead>
                                <tbody id="workHoursTableBody">
                                    <!-- Rows will be added dynamically by JS -->
                                </tbody>
                            </table>
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-primary" id="addWorkHourRowBtn"><i class="fas fa-plus me-1"></i> Añadir Línea de Horas</button>

                        <!-- Materiales Table -->
                        <hr class="my-4">
                        <h6 class="mb-3 text-dark-emphasis">Líneas de Materiales</h6>
                        <div class="table-responsive mb-3">
                            <table class="table table-bordered table-sm" id="materialsTable">
                                <thead class="table-light">
                                    <tr>
                                        <th>Proveedor</th>
                                        <th>Albarán</th>
                                        <th>Fecha</th>
                                        <th>Concepto</th>
                                        <th>Cant.</th>
                                        <th>€/ud</th>
                                        <th>Dto %</th>
                                        <th>€ Dto</th>
                                        <th>Total</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="materialsTableBody">
                                    <!-- Rows will be added dynamically by JS -->
                                </tbody>
                            </table>
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-primary" id="addMaterialRowBtn"><i class="fas fa-plus me-1"></i> Añadir Línea de Material</button>

                        <div class="row mt-4">
                            <div class="col-md-4 mb-3 ms-auto">
                                <label for="ordenTrabajoImporte" class="form-label text-muted">Importe Total</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="ordenTrabajoImporte" step="0.01" min="0" required readonly>
                                    <span class="input-group-text">€</span>
                                </div>
                            </div>
                        </div>
                        <div class="d-flex justify-content-end">
                            <button type="button" class="btn btn-danger me-auto" id="ordenTrabajoModalDeleteBtn" style="display: none;"><i class="fas fa-trash me-2"></i> Borrar Orden</button>
                            <button class="btn btn-primary" id="ordenTrabajoModalSubmitBtn"><i class="fas fa-plus me-2"></i> Crear Orden</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- /Orden de Trabajo Management Modal -->

    <!-- Ordenes de Trabajo Modal -->
    <div class="modal fade" id="ordenesModal" data-bs-backdrop="static" tabindex="-1" aria-labelledby="ordenesModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content border-0 shadow-lg dashboard-card">
                <div class="modal-header bg-white border-0 pb-0">
                    <h5 class="modal-title text-dark-emphasis" id="ordenesModalLabel"><i class="fas fa-clipboard-list me-2 text-primary"></i> Órdenes de trabajos</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex align-items-center bg-transparent border-0 py-2 ps-0">
                            <a href="#" class="nav-link-in-modal text-dark text-decoration-none w-100" data-bs-dismiss="modal" data-target="presupuestos" data-name="Presupuestos" data-icon="fas fa-file-invoice-dollar">
                                <i class="fas fa-file-invoice-dollar me-2"></i> Presupuestos
                            </a>
                        </li>
                        <li class="list-group-item d-flex align-items-center bg-transparent border-0 py-2 ps-0">
                            <a href="#" class="nav-link-in-modal text-dark text-decoration-none w-100" data-bs-dismiss="modal" data-target="ordenes" data-name="Órdenes" data-icon="fas fa-file-alt">
                                <i class="fas fa-file-alt me-2"></i> Órdenes
                            </a>
                        </li>
                        <li class="list-group-item d-flex align-items-center bg-transparent border-0 py-2 ps-0">
                            <a href="#" class="nav-link-in-modal text-dark text-decoration-none w-100" data-bs-dismiss="modal" data-target="historial" data-name="Historial" data-icon="fas fa-history">
                                <i class="fas fa-history me-2"></i> Historial
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <!-- /Ordenes de Trabajo Modal -->

    <!-- Message Modal -->
    <div class="modal fade" id="messageModal" tabindex="-1" aria-labelledby="messageModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg dashboard-card">
                <div class="modal-header bg-white border-0 pb-0">
                    <h5 class="modal-title text-dark-emphasis" id="messageModalLabel"><i class="fas fa-comments me-2 text-primary"></i> Mensajes</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-0 d-flex" style="height: 60vh; background-color: #ffffff !important;"> <!-- Flex container for chat layout -->
                    <!-- Chat Users Sidebar -->
                    <div class="d-flex flex-column border-end bg-light-subtle" style="width: 250px; flex-shrink: 0;">
                        <div class="p-3 border-bottom">
                            <h6 class="mb-0 text-dark-emphasis">Usuarios Disponibles</h6>
                        </div>
                        <ul class="list-group list-group-flush flex-grow-1 overflow-auto" id="chatUsersList">
                            <!-- User list dynamically loaded here -->
                        </ul>
                    </div>
                    <!-- Chat Window -->
                    <div class="d-flex flex-column flex-grow-1">
                        <div class="p-3 border-bottom bg-light-subtle">
                            <h6 class="mb-0 text-dark-emphasis" id="chatPartnerName">Selecciona un usuario para chatear</h6>
                        </div>
                        <div class="chat-messages p-3 flex-grow-1 overflow-auto" id="chatMessagesContainer">
                            <!-- Messages dynamically loaded here -->
                            <div class="text-center text-muted mt-5" id="noChatSelectedMessage">
                                <i class="fas fa-comment-dots fs-1 mb-3"></i>
                                <p>¡Inicia una conversación!</p>
                                <small>Selecciona un usuario de la lista de la izquierda para comenzar.</small>
                            </div>
                        </div>
                        <div class="chat-input-area p-3 border-top bg-light-subtle" id="chatInputArea" style="display: none;">
                            <div class="input-group">
                                <input type="text" class="form-control" id="chatMessageInput" placeholder="Escribe tu mensaje..." aria-label="Escribe tu mensaje">
                                <button class="btn btn-primary" type="button" id="sendChatMessageBtn"><i class="fas fa-paper-plane"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /Message Modal -->

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="app.js"></script>
</body>
</html>